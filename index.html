<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>제품 위치 찾기 - dsi전</title>
  <style>
    /* 전체 중앙 정렬 */
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      margin: 30px;
    }

    /* 제목 중앙 */
    h2 {
      color: #333;
      text-align: center;
    }

    /* 입력창, 버튼, 드롭다운 중앙 */
    input, button, select {
      padding: 6px;
      margin: 5px;
      text-align: center;
    }

    /* 시트 버튼 영역 중앙 */
    #sheetButtons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px 0;
    }

    #sheetButtons span {
      margin-right: 10px;
      font-weight: bold;
      align-self: center;
    }

    /* 테이블 중앙, 자동 너비 */
    table {
      border-collapse: collapse;
      margin: 20px 0;
      width: auto;
      text-align: center;
    }

    /* 테이블 셀 스타일 */
    td, th {
      border: 1px solid #aaa;
      padding: 6px 12px;
      text-align: center;
    }

    /* 하이라이트 */
    .highlight {
      background-color: yellow;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>제품 위치 찾기 (시트 선택 + 하이라이트)</h2>

  <input type="text" id="searchBox" placeholder="제품명을 입력하세요">
  <button onclick="searchProduct()">찾기</button>

  <div id="sheetButtons"></div>
  <table id="productTable"></table>

  <script>
    const SPREADSHEET_ID = "14eYGH3njFIqQr7pX8ClJ5LdIiNnQ272QOYiyeTzATsM"; // 실제 ID로 교체
    const API_KEY = "AIzaSyDhgt-UIJklNeg-Jjky0-3piV6XQx4nrsc"; // 실제 API Key로 교체
    const SHEETS = ["MAIN", "DSI", "TEST"]; // 필요 시 시트 추가 

    let matchingSheets = [];
    let currentSearchValue = "";

    // 시트 전체 데이터 가져오기
    async function fetchSheet(sheetName) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${sheetName}?key=${API_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      return data.values || [];
    }

    // 시트 데이터 테이블 표시
    function displaySheet(rows, searchValue) {
      const table = document.getElementById("productTable");
      table.innerHTML = "";

      // 헤더 추가
      const headerRow = document.createElement("tr");
      rows[0].forEach(cell => {
        const th = document.createElement("th");
        th.textContent = cell;
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      // 데이터 행 추가
      rows.slice(1).forEach(row => {
        const tr = document.createElement("tr");
        row.forEach(cell => {
          const td = document.createElement("td");
          td.textContent = cell;
          if (typeof cell === "string" && cell.toLowerCase().includes(searchValue)) {
            td.classList.add("highlight");
          }
          tr.appendChild(td);
        });
        table.appendChild(tr);
      });
    }

    // 검색 + 시트 버튼 표시
    async function searchProduct() {
      const searchValue = document.getElementById("searchBox").value.trim().toLowerCase();
      currentSearchValue = searchValue;

      const table = document.getElementById("productTable");
      const sheetButtons = document.getElementById("sheetButtons");
      table.innerHTML = "";
      sheetButtons.innerHTML = ""; // 기존 버튼 초기화

      if (searchValue.length < 5) {
        alert("제품명을 최소 5자 이상 입력해주세요.");
        return;
      }

      matchingSheets = [];

      // 모든 시트 검색
      for (let sheet of SHEETS) {
        const rows = await fetchSheet(sheet);
        const hasProduct = rows.some(row => row.some(cell => typeof cell === "string" && cell.toLowerCase().includes(searchValue)));
        if (hasProduct) {
          matchingSheets.push({ name: sheet, data: rows });
        }
      }

      if (matchingSheets.length === 0) {
        alert("제품을 찾을 수 없습니다.");
        return;
      }

      // 시트가 하나면 바로 표시
      if (matchingSheets.length === 1) {
        displaySheet(matchingSheets[0].data, searchValue);
        return;
      }

      // 시트가 2개 이상일 때만 문구 + 버튼 생성
      const label = document.createElement("div"); // span → div
      label.textContent = "⬇️⬇️아래에서 조회할 시트를 선택해 주세요⬇️⬇️";
      label.style.marginBottom = "10px";
      label.style.fontWeight = "bold";
      label.style.textAlign = "center";
      sheetButtons.appendChild(label);
      
      // 버튼 전용 div
      const sheetList = document.createElement("div");
      sheetList.id = "sheetList";
      sheetList.style.display = "flex";
      sheetList.style.justifyContent = "center";
      sheetList.style.gap = "8px"; // 버튼 간격
      sheetButtons.appendChild(sheetList);
      
      matchingSheets.forEach(sheet => {
        const btn = document.createElement("button");
        btn.textContent = sheet.name;
        btn.onclick = () => displaySheet(sheet.data, searchValue);
        sheetList.appendChild(btn); // 버튼을 sheetList 안에 넣음
      });
    }
  </script>

</body>
</html>
